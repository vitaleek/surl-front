Простой веб-сервис, реализующий клиент-серверный обмен данными, написан для тестового задания. Построен с использованием фреймврка Spring. В качестве веб-сервера используется GlassFish 3.
Простая база данных PotgreSQL, содержит две таблицы: users, link. Одно из полей таблицы используется для хранения массива тегов.
Клиентский одностраничный интерфейс реализован на базе EmberJS. Для обмена данными и сериализации (на стороне сервера) используется пакет JSONSimple. Краткий функционал и логика работы приложения: со стартовой страницы клиент может выбрать функции входа,
регистрации и получения информации об интересующей ссылке(уже короткой). При входе пользователь вводит логин, пароль. Если одно из полей пустое, всплывающее окно предупреждает о необходимости заполнения полей.
Если пароль неверен, то со стороны сервера и, соответсвенно, во всплывающем окне появляется сообщение. Если пароль и логин совпадают с имеющимися в базе, то происходит переход на страницу выбора функционала зарегистрированного пользователя, а именно: сокращения ссылки и просмотра статистики о использовании уже имеющихся в базе ссылок (количество переходов по ссылкам пользователя). При выборе первого пункта меню (воспользоваться сократителем ссылок) происходит переход на страницу, где пользователь вводит необходимые атрибуты: оригинальную ("длинную") ссылку, описание и набор тегов. Если какое-либо из полей не заполнено, пользователь извещается об этом. Общее количество тегов - 5. Если все в порядке, пользователь получает сообщение об успешном добавлении ссылки в базу и возвращается на страницу выбора функционала зарегистрированного пользователя. При выборе второго пункта меню (показать статистику переходов) выводится собственно статистика, на этой странице аользователь может войти в режим редактирования и изменить описание и/или имеющиеся теги. Опять-таки, при незаполнеии полей пользователь извещается об этом. При входе на страницу регистрации гость вводит логин и пароль, при этом на стороне сервера происходит проверка и, если такой логин уже имеется в базе, выдается сообщение об этом. В случае удачной регистрации пользователь попадает на страницу выбора функционала зарегистрированного пользователя, описанную выше. В случае же выбора пункта получения информации об интересующей ссылке гость в открывшемся окне вводит ссылку (короткую) и получает информацию: описание и список тегов. Гость может щелкнуть по любому из тегов и получить список ссылок, связанных с этим тегом. Для возврата в основное меню гость может щелкнуть по кнопке "main menu", доступной из любой части приложения.
Для организации корректного обмена данными между клиентом и сервером в каждый сериализуемый пакет вводится строковый ключ, например, "LINK_ghjytrdefgh", в который добавлен набор псевдо-случайных символов, по которому происходит выбор выполняемого сценария на стороне сервера. Набор псевдо-случайных символов вводится для того, чтобы обезопасить сериализацию данных от случайного совпадения с данными, которые зависят от пользователя (напр, пользователь введет в качетсве логина или описания ссылки фрагменты "user", "link" и т.д.)
Для генерации короткой ссылки используется генератор случайных сиволов (logic/Core.java) в диапазоне разрешенных для использования в URI. По умолчанию длина короткой ссылки выбрана равной восьми символам, хотя для реального сервиса имело бы смысл ввести нарастающую длину ссылки, начиная от , скажем, одного символа по мере заполнения базы данных.
После генерации короткой ссылки производится единоразовая проверка сгенерированной ссылки на случайное совпадение с уже имеющейся в базе. Для реального сервиса с большой базой данных проверку имело бы смысл усложнить (использовать цикл до полной проверки на неналичие в базе). Для тестового сервиса вполне достаточно единоразовой проверки -- вероятность попадания после нее становится ничтожно малой.
В отдельном модуле (redirect/RedirectServer.java) реализован сервер на порту 80, который отслеживает HTTP-запросы на определенный хост и производит перенаправление запроса с коротких ссылок на оригинальные. Для простоты тестовый сервер обрабатывает заголовки GET-запросов длиной 64 kb.
